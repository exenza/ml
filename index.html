<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>

<style>
#container {
	margin: 0px auto;
	width: 640px;
	height: 480px;
	border: 10px #333 solid;
}
#videoElement,
#canvas {
	width: 640px;
	height: 480px;
	background-color: #666;
}
</style>


<script src="aws-sdk-2.663.0.min.js"></script>

</head>

<body>
	V 1.84
	<div id="amazon-root"></div>
 <script type="text/javascript">

    window.onAmazonLoginReady = function() {
      amazon.Login.setClientId('amzn1.application-oa2-client.224b722d73d04cd0818e1c4d64454622');
    };
    (function(d) {
      var a = d.createElement('script'); a.type = 'text/javascript';
      a.async = true; a.id = 'amazon-login-sdk';
      a.src = 'https://assets.loginwithamazon.com/sdk/na/login1.js';
      d.getElementById('amazon-root').appendChild(a);
    })(document);

</script>

	<a href id="LoginWithAmazon">
	    <img border="0" alt="Login with Amazon"
	        src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png"
	        width="156" height="32" />
	 </a> -- <a onclick="amazon.Login.logout()" href="/ml">Logout</a>

	 <script type="text/javascript">
	     document.getElementById('LoginWithAmazon').onclick = function() {
	         options = {}
	         options.scope = 'profile';
	         options.scope_data = {
	             'profile' : {'essential': false}
	         };
	         amazon.Login.authorize(options,
	             'https://exenza.github.io/ml/?loggedin=true');
	         return false;
	     };
	 </script>

	 <hr>

  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480"></canvas>
<script>
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);


//eu-west-2:85d2566f-591d-4017-a27c-bc9eabdc622a
//amzn1.application-oa2-client.224b722d73d04cd0818e1c4d64454622
if(urlParams.get('loggedin')){
	if(urlParams.get('loggedin')){
		AWS.config.credentials = new AWS.WebIdentityCredentials({
		    RoleArn: 'arn:aws:iam::596463222163:role/mljs',
		    ProviderId: 'graph.facebook.com|www.amazon.com', // Omit this for Google
		    WebIdentityToken: urlParams.get('access_token') // Access token from identity provider
		});
	}
	s3 = new AWS.S3

	console.log(s3.ls)

}



// Grab elements, create settings, etc.
var video = document.getElementById('video');

// Get access to the camera!
if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    // Not adding `{ audio: true }` since we only want video now
    navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
        //video.src = window.URL.createObjectURL(stream);
        video.srcObject = stream;
        video.play();
    });
}

// Elements for taking the snapshot
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
var video = document.getElementById('video');

// Trigger photo take
function snap(){
	context.drawImage(video, 0, 0, 640, 480);
}

window.setInterval(function(){
  snap()
}, 300);

</script>
</body>
</html>
